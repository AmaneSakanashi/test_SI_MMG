import matplotlib.path as mpath
import matplotlib.patches as mpatches
import matplotlib.pyplot as plt
import os
import sys
sys.path.append('/workspaces/no_stop_development-of-berthing-indicator-for-trajectory-planning/shipsim/world/utils')

from pyproj import Transformer

# class Port_Ariake:
#     def __init__(self) -> None:
#         self.obstacle = 
#         self.init_x =
#         self.init_y = 
        
#     def a():
#         a



def main():
    # convert to local coord.
    
    berth_latlon = [139.7916076222295, 35.61671139088672]
    offshore_latlon = [139.8283315745129, 35.60869017029386]
    # berth_point = [0.0, 0.0]
    # berth_xy = latlon_to_xy(berth_latlon)
    ISLAND1 = [
            latlon_to_xy([139.7901634501031, 35.59547095729461]),
            latlon_to_xy([139.7905687114993, 35.59240236779743]),
            latlon_to_xy([139.8084537164465, 35.58385719087195]),
            latlon_to_xy([139.8134041296033, 35.57872221923013]),
            latlon_to_xy([139.8322408686126, 35.58892085161354]),
            latlon_to_xy([139.8251718768946, 35.6091884033497]),
            latlon_to_xy([139.8247034161743, 35.61004444406954]),
            latlon_to_xy([139.8105910645289, 35.61319409205115]),
            latlon_to_xy([139.7985199376006, 35.60699952194481]),
    ]
    ISLAND2 = [
        latlon_to_xy([139.7840116371565, 35.58602314425631]),
        latlon_to_xy([139.7786398782573, 35.58656934564117]),
        latlon_to_xy([139.776798203173, 35.59028285963381]),
        latlon_to_xy([139.7728459435342, 35.59550822606797]),
        latlon_to_xy([139.7732470941035, 35.59565611337559]),
        latlon_to_xy([139.763471106063, 35.60874108591264]),
        latlon_to_xy([139.7639359010002, 35.60892386580851]),
        latlon_to_xy([139.7620716607107, 35.61458115816069]),
        latlon_to_xy([139.760188453251, 35.61587130188788]),
        latlon_to_xy([139.7582130652306, 35.61767460503712]),
        latlon_to_xy([139.753728980023, 35.61781667350453]),
        latlon_to_xy([139.7556049817003, 35.58503075356742]),
        latlon_to_xy([139.7581459805684, 35.57711652229445]),
        latlon_to_xy([139.7833679404949, 35.57699027515476]),
        latlon_to_xy([139.7852690085665, 35.57728259109539]),
        latlon_to_xy([139.7872876663072, 35.57901184761122]),
        latlon_to_xy([139.7874485141671, 35.58007671550587]),
        latlon_to_xy([139.7870787788473, 35.58051048970084]),
    ]
    ISLAND3 = [
        latlon_to_xy([139.7809659397222, 35.62385809313109]),
        latlon_to_xy([139.7846527723143, 35.62584606717458]),
        latlon_to_xy([139.7849512478385, 35.62636713806176]),
        latlon_to_xy([139.7770276850012, 35.63610721656408]),
        latlon_to_xy([139.7765436909733, 35.63624875044586]),
        latlon_to_xy([139.7731133877699, 35.63441106173274]),
        latlon_to_xy([139.7725786633085, 35.63452735831193]),
        latlon_to_xy([139.7723477843437, 35.63431167418384]),
        latlon_to_xy([139.7717087322279, 35.63448662720862]),
        latlon_to_xy([139.7713773224112, 35.63434308396597]),
        latlon_to_xy([139.7659764469195, 35.62749633478186]),
        latlon_to_xy([139.7663197182134, 35.62547620791409]),
        latlon_to_xy([139.767567509762, 35.62581778044898]),
        latlon_to_xy([139.7676396679746, 35.62206767403751]),
        latlon_to_xy([139.770508084941, 35.61880735285107]),
        latlon_to_xy([139.7698468301595, 35.61830678102704]),
        latlon_to_xy([139.7743934201565, 35.61276256720598]),
        latlon_to_xy([139.7767813472363, 35.61405876490618]),
        latlon_to_xy([139.7867363385852, 35.60182971213103]),
        latlon_to_xy([139.7869149917893, 35.60191182178781]),
        latlon_to_xy([139.7926642084117, 35.60957154416009]),
    ]
    ISLAND4 = [
        latlon_to_xy([139.7944388561118, 35.61389566829962]),
        latlon_to_xy([139.7946474444937, 35.613829864025]),
        latlon_to_xy([139.794763027518, 35.61401779480705]),
        latlon_to_xy([139.7946950258525, 35.61451015941409]),
        latlon_to_xy([139.7950513588569, 35.61452052854359]),
        latlon_to_xy([139.7952122295501, 35.61445017428096]),
        latlon_to_xy([139.7957166985955, 35.61537922988396]),
        latlon_to_xy([139.7960444049827, 35.61526991246244]),
        latlon_to_xy([139.797016019837, 35.61718025669978]),
        latlon_to_xy([139.797424703931, 35.61704481440141]),
        latlon_to_xy([139.7976779400188, 35.61738554848476]),
        latlon_to_xy([139.7979415164677, 35.61771305228306]),
        latlon_to_xy([139.7979373565803, 35.61774266067761]),
        latlon_to_xy([139.7965472409096, 35.61899023672212]),
        latlon_to_xy([139.7967537860316, 35.61914758891601]),
        latlon_to_xy([139.7967561940843, 35.61918519826108]),
        latlon_to_xy([139.7955285151168, 35.62024394257446]),
        latlon_to_xy([139.795735115838, 35.62039781548311]),
        latlon_to_xy([139.7957384668882, 35.62043852839398]),
        latlon_to_xy([139.789885322463, 35.62765903382191]),
        latlon_to_xy([139.7852744980869, 35.6251399896173]),
    ]
    ISLAND5 = [
        latlon_to_xy([139.8274428433318, 35.61981841782596]),
        latlon_to_xy([139.8306526329218, 35.61851282401651]),
        latlon_to_xy([139.8280337649666, 35.61205783228903]),
        latlon_to_xy([139.8284068027544, 35.61148278441541]),
        latlon_to_xy([139.8355323526705, 35.61243055747283]),
        latlon_to_xy([139.838611086022, 35.61420839631295]),
        latlon_to_xy([139.840190284418, 35.63212389000152]),
        latlon_to_xy([139.8257655868246, 35.6307241325717]),
    ]
    ISLAND6 = [
        latlon_to_xy([139.8176872525074, 35.61754040137832]),
        latlon_to_xy([139.8220140862472, 35.61924232778082]),
        latlon_to_xy([139.8230779398323, 35.62309860050571]),
        latlon_to_xy([139.8205016529804, 35.6390319175060]),
        latlon_to_xy([139.8183605227454, 35.6397417266667]),
        latlon_to_xy([139.8099182664366, 35.6387196683003]),
        latlon_to_xy([139.8092948763015, 35.63833908525579]),
        latlon_to_xy([139.8072755754833, 35.62709718731983]),
        latlon_to_xy([139.8095332132342, 35.6210414944472]),
    ]
    ISLAND7 = [
        latlon_to_xy([139.7986163533176, 35.62175352889899]),
        latlon_to_xy([139.7989363343402, 35.6217534461743]),
        latlon_to_xy([139.8022114947937, 35.62624034001264]),
        latlon_to_xy([139.8004276317492, 35.6310375959602]),
        latlon_to_xy([139.801457565064, 35.6328641316702]),
        latlon_to_xy([139.8014854191158, 35.6364400961430]),
        latlon_to_xy([139.7945111210763, 35.64488522408666]),
        latlon_to_xy([139.7812615888726, 35.63879608664859]),
        latlon_to_xy([139.7786050998327, 35.63736025562959]),
        latlon_to_xy([139.7849452511322, 35.6295624913120]),
        latlon_to_xy([139.7873630375335, 35.62727834019718]),
        latlon_to_xy([139.7920051182255, 35.6298822685433]),
    ]
    
    # print(latlon_to_xy([139.7901634501031, 35.59547095729461]))
    # 原点を設定
    # origin = ISLAND4[-3]
    origin = latlon_to_xy(berth_latlon)

    # 新しい座標系を作成
    ISLAND1_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND1]
    ISLAND2_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND2]
    ISLAND3_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND3]
    ISLAND4_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND4]
    ISLAND5_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND5]
    ISLAND6_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND6]
    ISLAND7_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND7]
    ISLANDs = [ISLAND1_local, ISLAND2_local, ISLAND3_local, ISLAND4_local, ISLAND5_local, ISLAND6_local, ISLAND7_local]

    vertices = [(0,0), (1,3), (5,5), (4,3), (5,0), (0,0)]
    # print(ISLAND1)
    fig, ax = plt.subplots()
    ax.grid()
    ax.set_title("ISLAND1", fontsize=16)
    # ax.set_xlim(left=-140, right=140)
    # ax.set_ylim(bottom=-140, top=140)
    polygon_list = []
    for island in ISLANDs:
        path = mpath.Path(island)
        polygon = mpatches.Polygon(island)
        polygon_list.append(polygon.copy())
        ax.add_patch(polygon)
    # polygon2 = mpatches.Polygon(ISLAND2) 
    # ax.add_patch(polygon2)
    # polygon_test = mpatches.Polygon(vertices)
    # ax.add_patch(polygon_test)
    # plt.show()
    ax.autoscale_view()
    plt.savefig("test.pdf")
    
    print("Task Complited")
    
def latlon_to_xy(latlon):
    # # WGS84 datum (used by GPS)
    # wgs84 = Proj(init='EPSG:4326')

    # # UTM zone 33 (used for East Norway)
    # utm33 = Proj(init='EPSG:32633')

    # x, y = transform(wgs84, utm33, latlon[1], latlon[0])
    # return x, y

    lat, lon = latlon[1], latlon[0]
    wgs84_epsg, rect_epsg = 4326, 6677
    tr = Transformer.from_proj(wgs84_epsg, rect_epsg)
    x, y = tr.transform(lat, lon)
    return x, y

def obstacle_ariake():
    berth_latlon = [139.7916076222295, 35.61671139088672]
    offshore_latlon = [139.8283315745129, 35.60869017029386]
    # berth_point = [0.0, 0.0]
    # berth_xy = latlon_to_xy(berth_latlon)
    ISLAND1 = [
            latlon_to_xy([139.7901634501031, 35.59547095729461]),
            latlon_to_xy([139.7905687114993, 35.59240236779743]),
            latlon_to_xy([139.8084537164465, 35.58385719087195]),
            latlon_to_xy([139.8134041296033, 35.57872221923013]),
            latlon_to_xy([139.8322408686126, 35.58892085161354]),
            latlon_to_xy([139.8251718768946, 35.6091884033497]),
            latlon_to_xy([139.8247034161743, 35.61004444406954]),
            latlon_to_xy([139.8105910645289, 35.61319409205115]),
            latlon_to_xy([139.7985199376006, 35.60699952194481]),
    ]
    ISLAND2 = [
        latlon_to_xy([139.7840116371565, 35.58602314425631]),
        latlon_to_xy([139.7786398782573, 35.58656934564117]),
        latlon_to_xy([139.776798203173, 35.59028285963381]),
        latlon_to_xy([139.7728459435342, 35.59550822606797]),
        latlon_to_xy([139.7732470941035, 35.59565611337559]),
        latlon_to_xy([139.763471106063, 35.60874108591264]),
        latlon_to_xy([139.7639359010002, 35.60892386580851]),
        latlon_to_xy([139.7620716607107, 35.61458115816069]),
        latlon_to_xy([139.760188453251, 35.61587130188788]),
        latlon_to_xy([139.7582130652306, 35.61767460503712]),
        latlon_to_xy([139.753728980023, 35.61781667350453]),
        latlon_to_xy([139.7556049817003, 35.58503075356742]),
        latlon_to_xy([139.7581459805684, 35.57711652229445]),
        latlon_to_xy([139.7833679404949, 35.57699027515476]),
        latlon_to_xy([139.7852690085665, 35.57728259109539]),
        latlon_to_xy([139.7872876663072, 35.57901184761122]),
        latlon_to_xy([139.7874485141671, 35.58007671550587]),
        latlon_to_xy([139.7870787788473, 35.58051048970084]),
    ]
    ISLAND3 = [
        latlon_to_xy([139.7809659397222, 35.62385809313109]),
        latlon_to_xy([139.7846527723143, 35.62584606717458]),
        latlon_to_xy([139.7849512478385, 35.62636713806176]),
        latlon_to_xy([139.7770276850012, 35.63610721656408]),
        latlon_to_xy([139.7765436909733, 35.63624875044586]),
        latlon_to_xy([139.7731133877699, 35.63441106173274]),
        latlon_to_xy([139.7725786633085, 35.63452735831193]),
        latlon_to_xy([139.7723477843437, 35.63431167418384]),
        latlon_to_xy([139.7717087322279, 35.63448662720862]),
        latlon_to_xy([139.7713773224112, 35.63434308396597]),
        latlon_to_xy([139.7659764469195, 35.62749633478186]),
        latlon_to_xy([139.7663197182134, 35.62547620791409]),
        latlon_to_xy([139.767567509762, 35.62581778044898]),
        latlon_to_xy([139.7676396679746, 35.62206767403751]),
        latlon_to_xy([139.770508084941, 35.61880735285107]),
        latlon_to_xy([139.7698468301595, 35.61830678102704]),
        latlon_to_xy([139.7743934201565, 35.61276256720598]),
        latlon_to_xy([139.7767813472363, 35.61405876490618]),
        latlon_to_xy([139.7867363385852, 35.60182971213103]),
        latlon_to_xy([139.7869149917893, 35.60191182178781]),
        latlon_to_xy([139.7926642084117, 35.60957154416009]),
    ]
    ISLAND4 = [
        latlon_to_xy([139.7944388561118, 35.61389566829962]),
        latlon_to_xy([139.7946474444937, 35.613829864025]),
        latlon_to_xy([139.794763027518, 35.61401779480705]),
        latlon_to_xy([139.7946950258525, 35.61451015941409]),
        latlon_to_xy([139.7950513588569, 35.61452052854359]),
        latlon_to_xy([139.7952122295501, 35.61445017428096]),
        latlon_to_xy([139.7957166985955, 35.61537922988396]),
        latlon_to_xy([139.7960444049827, 35.61526991246244]),
        latlon_to_xy([139.797016019837, 35.61718025669978]),
        latlon_to_xy([139.797424703931, 35.61704481440141]),
        latlon_to_xy([139.7976779400188, 35.61738554848476]),
        latlon_to_xy([139.7979415164677, 35.61771305228306]),
        latlon_to_xy([139.7979373565803, 35.61774266067761]),
        latlon_to_xy([139.7965472409096, 35.61899023672212]),
        latlon_to_xy([139.7967537860316, 35.61914758891601]),
        latlon_to_xy([139.7967561940843, 35.61918519826108]),
        latlon_to_xy([139.7955285151168, 35.62024394257446]),
        latlon_to_xy([139.795735115838, 35.62039781548311]),
        latlon_to_xy([139.7957384668882, 35.62043852839398]),
        latlon_to_xy([139.789885322463, 35.62765903382191]),
        latlon_to_xy([139.7852744980869, 35.6251399896173]),
    ]
    ISLAND5 = [
        latlon_to_xy([139.8274428433318, 35.61981841782596]),
        latlon_to_xy([139.8306526329218, 35.61851282401651]),
        latlon_to_xy([139.8280337649666, 35.61205783228903]),
        latlon_to_xy([139.8284068027544, 35.61148278441541]),
        latlon_to_xy([139.8355323526705, 35.61243055747283]),
        latlon_to_xy([139.838611086022, 35.61420839631295]),
        latlon_to_xy([139.840190284418, 35.63212389000152]),
        latlon_to_xy([139.8257655868246, 35.6307241325717]),
    ]
    ISLAND6 = [
        latlon_to_xy([139.8176872525074, 35.61754040137832]),
        latlon_to_xy([139.8220140862472, 35.61924232778082]),
        latlon_to_xy([139.8230779398323, 35.62309860050571]),
        latlon_to_xy([139.8205016529804, 35.6390319175060]),
        latlon_to_xy([139.8183605227454, 35.6397417266667]),
        latlon_to_xy([139.8099182664366, 35.6387196683003]),
        latlon_to_xy([139.8092948763015, 35.63833908525579]),
        latlon_to_xy([139.8072755754833, 35.62709718731983]),
        latlon_to_xy([139.8095332132342, 35.6210414944472]),
    ]
    ISLAND7 = [
        latlon_to_xy([139.7986163533176, 35.62175352889899]),
        latlon_to_xy([139.7989363343402, 35.6217534461743]),
        latlon_to_xy([139.8022114947937, 35.62624034001264]),
        latlon_to_xy([139.8004276317492, 35.6310375959602]),
        latlon_to_xy([139.801457565064, 35.6328641316702]),
        latlon_to_xy([139.8014854191158, 35.6364400961430]),
        latlon_to_xy([139.7945111210763, 35.64488522408666]),
        latlon_to_xy([139.7812615888726, 35.63879608664859]),
        latlon_to_xy([139.7786050998327, 35.63736025562959]),
        latlon_to_xy([139.7849452511322, 35.6295624913120]),
        latlon_to_xy([139.7873630375335, 35.62727834019718]),
        latlon_to_xy([139.7920051182255, 35.6298822685433]),
    ]
    
    # print(latlon_to_xy([139.7901634501031, 35.59547095729461]))
    # 原点を設定
    # origin = ISLAND4[-3]
    origin = latlon_to_xy(berth_latlon)

    # 新しい座標系を作成
    ISLAND1_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND1]
    ISLAND2_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND2]
    ISLAND3_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND3]
    ISLAND4_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND4]
    ISLAND5_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND5]
    ISLAND6_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND6]
    ISLAND7_local = [(x - origin[0], y - origin[1]) for x, y in ISLAND7]
    ISLANDs = [ISLAND1_local, ISLAND2_local, ISLAND3_local, ISLAND4_local, ISLAND5_local, ISLAND6_local, ISLAND7_local]
    
    combined_polygon = mpatches.Polygon()
    for island in ISLANDs:
        path = mpath.Path(island)
        polygon = mpatches.Polygon(island)
        combined_polygon = combined_polygon.union(combined_polygon)
        # ax.add_patch(polygon)
        
    return combined_polygon
            

def obstacle():
    poly_berth = Polygon(
        (-17.367342327709544, 3.0280716041071876),
        (-17.229919542826263, 2.0116391359659676),
        (0.05456548589622058, 2.047358202565451),
        (0.1, -0.1),
        (-34.877044643377836, -0.10996771745214),
        (-34.92052111027342, 5.959692668341108),
        (0.1392873362209016, 6.1008259813208925),
        (0.07654556026854228, 2.931122867965844)
        )
    
    poly_inukai = Polygon(
        (-17.4041639227645, -0.12925881818829246),
        (-6.414817004034702, -11.812384726425321),
        (14.160894167967765, -8.581250293257213),
        (15.677049039474161, -18.325461626601435),
        (37.44972032749134, -15.3465043375155),
        (45.50594945449351, -21.619280499059908),
        (80.86622975263302, -8.147556473033676),
        (80.4012760552105, -1.0939661203973283),
        (95.79745356122645, 17.217912028003163),
        (85.31361082992204, 35.80118847887229),
        (65.91636202536348, 28.995865790495714),
        (54.98601351245262, 28.87097991996618),
        (48.204300713876925, 31.123524695708458),
        (36.87042995953886, 22.787911163883823),
        (30.885356185460182, 16.475548094518018),
        (20.727043893674185, 11.136354927102106),
        (5.254496596443306, 11.688113550822017),
        (-5.74389020600862, 13.581857826197325),
        (-17.25645136976518, 13.635022885046578),
        (-17.15081445223532, 6.106747543038868),
        (-35.06010219171111, 5.951132924774719),
        (-34.61614022958422, 61.675690306113744),
        (96.6583511430393, 74.84492906869976),
        (122.51707712663774, 6.283627007806029),
        (102.43685031806156, -38.75127279270508),
        (-35.27378062838487, -32.65539042814767),
        (-35.55403543599456, -0.533620395406752),
        (-17.4041639227645, -0.12925881818829246)
    )
        
    return poly_berth, poly_inukai
    
    
    
def mat_obstacle():
    poly_berth = mpath.Path([
        (-17.367342327709544, 3.0280716041071876),
        (-17.229919542826263, 2.0116391359659676),
        (0.05456548589622058, 2.047358202565451),
        (0.1, -0.1),
        (-34.877044643377836, -0.10996771745214),
        (-34.92052111027342, 5.959692668341108),
        (0.1392873362209016, 6.1008259813208925),
        (0.07654556026854228, 2.931122867965844)
    ]
    )
        
    poly_inukai = mpath.Path([
        (-17.4041639227645, -0.12925881818829246),
        (-6.414817004034702, -11.812384726425321),
        (14.160894167967765, -8.581250293257213),
        (15.677049039474161, -18.325461626601435),
        (37.44972032749134, -15.3465043375155),
        (45.50594945449351, -21.619280499059908),
        (80.86622975263302, -8.147556473033676),
        (80.4012760552105, -1.0939661203973283),
        (95.79745356122645, 17.217912028003163),
        (85.31361082992204, 35.80118847887229),
        (65.91636202536348, 28.995865790495714),
        (54.98601351245262, 28.87097991996618),
        (48.204300713876925, 31.123524695708458),
        (36.87042995953886, 22.787911163883823),
        (30.885356185460182, 16.475548094518018),
        (20.727043893674185, 11.136354927102106),
        (5.254496596443306, 11.688113550822017),
        (-5.74389020600862, 13.581857826197325),
        (-17.25645136976518, 13.635022885046578),
        (-17.15081445223532, 6.106747543038868),
        (-35.06010219171111, 5.951132924774719),
        (-34.61614022958422, 61.675690306113744),
        (96.6583511430393, 74.84492906869976),
        (122.51707712663774, 6.283627007806029),
        (102.43685031806156, -38.75127279270508),
        (-35.27378062838487, -32.65539042814767),
        (-35.55403543599456, -0.533620395406752),
        (-17.4041639227645, -0.12925881818829246)
    ]
    )
    
    return poly_berth, poly_inukai

if __name__ == "__main__":
    main()